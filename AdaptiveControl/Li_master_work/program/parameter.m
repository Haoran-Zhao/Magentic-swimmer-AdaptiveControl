
%-----Input sigal & reference
global u;  %---Input signal
global mode
u=[0;0;0.1026;0];





% Parameterized State-Space Model
R=5.05*0.3048; 
Omega=870/60*2*pi ; 
rho =1.29; 
A= pi*R^2 ; 
a=6.0 ; 
B=2; 
c=0.354*0.3048;
m=97.85/2.20462262 ;
sigma=(B*c)/(pi*R) ;
f_wake =0; 
Ib=0.86754;
e_MR=0;
r_cr_t=0.5 ;
r_crp=0.42 ;
g=9.81 ; 
i_s =0;
mb=1.5*0.2;
e =0; 
Mb=(mb*R^2)/(2)*(1-e/R)^2*g ;

K_MR=0.2; 
K_cr=0.8;
gamma=rho*a*c*R^4/Ib ; %
xi=-1+(r_crp^4/r_cr_t^4); %
C_T=0.00226 ;
Omega_f=gamma*Omega/R*(1+8/3*e_MR/R) ;

K_1=0; 
K_2=3/4*e_MR/R*Omega/Omega_f ; %
K_c=K_1+K_2 ; 
ym=0; 
Ht=0;
lm=0; 
Lt=1.2 ; 
hm = 0.2 ; 
Ixx =0.1997*7.345;
Iyy =0.6231*7.345;
Izz = 0.6*7.345; 


A_Q_MR=0.000018*20; %
B_Q_MR= 0.01 ; %
Tsi=0.598;
global AA;
global BB;
global CC;
global DD;
global Gn;
global Hn;
global nx;
global ny;
global Theta_a;
global Ar;


%----------original linear state-space computing-------------
AA = [%u v w p q r phi theta psi            beta1c                  beta1s  
     0 0 0 0 0 0 0    -g   0               -g                      0               %u
     0 0 0 0 0 0 0     0   g              -ym/Lt                 g-lm/Lt           %v
     0 0 0 0 0 0 0     0   0                0                      0               %w
     0 0 0 0 0 0 0     0   0   (-m*Ht*g*ym/Lt-3.281)/Ixx   m*g*(ym-Ht*lm/Lt)/Ixx   %p  
     0 0 0 0 0 0 0     0   0         m*g*hm/Iyy                  3.281/Iyy         %q
     0 0 0 0 0 0 0     0   0        2*m*g*ym/Izz                   0               %r
     0 0 0 1 0 0 0     0   0                0                      0               %phi
     0 0 0 0 1 0 0     0   0                0                      0               %theta
     0 0 0 0 0 1 0     0   0                0                      0               %psi
     0 0 0 0 0 0 0     0   0               -1/Tsi                   0               %beta1c
     0 0 0 0 0 0 0     0   0                0                    -1/Tsi];            %beta1s

Ar = [%u v w p q r phi theta psi            beta1c                  beta1s  
     0 0 0 0 0 0 0    -g   0               -g                      0               %u
     0 0 0 0 0 0 0     0   g              -ym/Lt                 g-lm/Lt           %v
     0 0 0 0 0 0 0     0   0                0                      0               %w
     0 0 0 0 0 0 0     0   0                -2                     3.7   %p  
     0 0 0 0 0 0 0     0   0                3                      10         %q
     0 0 0 0 0 0 0     0   0                1                      0               %r
     0 0 0 1 0 0 0     0   0                0                      0               %phi
     0 0 0 0 1 0 0     0   0                0                      0               %theta
     0 0 0 0 0 1 0     0   0                0                      0               %psi
     0 0 0 0 0 0 0     0   0               -1/Tsi                   0               %beta1c
     0 0 0 0 0 0 0     0   0                0                    -1/Tsi];            %beta1s
 
A_hover = [-0.0505000000000000,0,0,0,0,0,0,-9.81000000000000,0,-32.2000000000000,0;
    0,-0.154000000000000,0,0,0,0,9.81000000000000,0,0,0,32.2000000000000;
    0,0,-0.614000000000000,0,0,0.930000000000000,0,0,0,-9.75000000000000,-131;
    -0.144000000000000,0.143000000000000,0,0,0,0,0,0,0,0,166;
    -0.0561000000000000,-0.0585000000000000,0,0,0,0,0,0,0,82.6000000000000,0;
    0,0.0301000000000000,0.0857000000000000,-3.53000000000000,0,-4.13000000000000,0,0,0,0,0;
    0,0,0,1,0,0,0,0,0,0,0;
    0,0,0,0,1,0,0,0,0,0,0;
    0,0,0,0,0,1,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,-21.7391304347826,-4.10869565217391;
    0,0,0,0,-1,0,0,0,0,8,-21.7391304347826;];
 
A_cruise = [-0.122000000000000,0,0,0,0,-11,0,-g,0,-32.2000000000000,0;
     0,-0.155000000000000,0,0,0,-49.2000000000000,g,0,0,0,32.2000000000000;
     0,0,-1.01000000000000,11,49.2000000000000,0,0,0,0,0,0;
     0,0,-0.213000000000000,0,0,0,0,0,0,0,213;
     0,0,0.0728000000000000,0,0,0,0,0,0,108,0;
     0,0.401000000000000,0,0,0,-3.90000000000000,0,0,0,0,0;
     0,0,0,1,0,0,0,0,0,0,0;
     0,0,0,0,1,0,0,0,0,0,0;
     0,0,0,0,0,1,0,0,0,0,0;
     0,0,0,0,0,0,0,0,0,-28.9017341040462,-5.08670520231214;
     0,0,0,0,-1,0,0,0,0,12.1098265895954,-28.9017341040462;];
 
Ar_hover = [-0.0505000000000000,0,0,0,0,0,0,-9.81000000000000,0,-32.2000000000000,0;
    0,-0.154000000000000,0,0,0,0,9.81000000000000,0,0,0,32.2000000000000;
    0,0,-0.614000000000000,0,0,0.930000000000000,0,0,0,-9.75000000000000,-131;
    -0.144000000000000,0.143000000000000,0,0,0,0,0,0,0,0,100;
    -0.0561000000000000,-0.0585000000000000,0,0,0,0,0,0,0,100,0;
    0,0.0301000000000000,0.0857000000000000,-3.53000000000000,0,-4.13000000000000,0,0,0,0,0;
    0,0,0,1,0,0,0,0,0,0,0;
    0,0,0,0,1,0,0,0,0,0,0;
    0,0,0,0,0,1,0,0,0,0,0;
    0,0,0,0,0,0,0,0,0,-21.7391304347826,-4.10869565217391;
    0,0,0,0,-1,0,0,0,0,8,-21.7391304347826;];
    
Ar_cruise = [-0.122000000000000,0,0,0,0,-11,0,-g,0,-32.2000000000000,0;
     0,-0.155000000000000,0,0,0,-49.2000000000000,g,0,0,0,32.2000000000000;
     0,0,-1.01000000000000,11,49.2000000000000,0,0,0,0,0,0;
     0,0,-0.213000000000000,0,0,0,0,0,0,0,100;
     0,0,0.0728000000000000,0,0,0,0,0,0,100,0;
     0,0.401000000000000,0,0,0,-3.90000000000000,0,0,0,0,0;
     0,0,0,1,0,0,0,0,0,0,0;
     0,0,0,0,1,0,0,0,0,0,0;
     0,0,0,0,0,1,0,0,0,0,0;
     0,0,0,0,0,0,0,0,0,-28.9017341040462,-5.08670520231214;
     0,0,0,0,-1,0,0,0,0,12.1098265895954,-28.9017341040462;];

 BB = [%ulat ulon      ucol                               uped
      0     0         0                                0    %u
      0     0  -65.33078/(Lt*m)                      -1/m   %v
      0     0  -5826.8/m                               0    %w
      0     0  (-5826.8*ym-Ht*65.33078/Lt)/Ixx         0    %p
      0     0   -5826.8*lm/Iyy                         0    %q
      0     0         0                              Lt/Izz %r
      0     0         0                                0    %phi
      0     0         0                                0    %theta
      0     0         0                                0    %psi
      0     -1        0                                0    %beta1c
      1     0         0                                0];   %beta1s
B_hover = [
            0,0,0,0;
            0,0,0,0;
            0,0,0,-45.8000000000000;
            0,0,0,0;
            0,0,0,0;
            0,0,33.1000000000000,-3.33000000000000;
            0,0,0,0;
            0,0,0,0;
            0,0,0,0;
            0.680434782608696,-2.17391304347826,0,0;
            3.04347826086957,0.300000000000000,0,0;];
B_cruise = [
            0,0,0,0;
            0,0,11.2300000000000,0;
            0,0,0,-60.3000000000000;
            0,0,0,0;
            0,0,0,6.98000000000000;
            0,0,26.4000000000000,0;
            0,0,0,0;
            0,0,0,0;
            0,0,0,0;
            0.765895953757225,-2.41907514450867,0,0;
            3.58381502890173,0.578034682080925,0,0;];

 
 switch (mode)
    case 0
        AA = AA;
        BB = BB;
        Ar = Ar;
    case 1
        AA = A_hover;
        Ar = Ar_hover;
        BB = B_hover;
    case 2    
        AA = A_cruise;
        Ar = Ar_cruise;
        BB = B_cruise;
end    
 Theta_a=AA-Ar;
 

  
%CC=eye(11);
CC = eye(11);
DD=zeros(size(CC,1),size(BB,2));


 
nx=size(AA,1);
ny=size(CC,1);

Gn=eye(nx);
Hn=zeros(ny);
